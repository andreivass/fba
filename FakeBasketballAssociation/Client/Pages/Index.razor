@page "/"
@inject FakeBasketballAssociation.Client.Repository.IPlayerRepository playersRepo
@inject FakeBasketballAssociation.Client.Repository.IVoteRepository votesRepo
@using FakeBasketballAssociation.Shared.Entities

<h2>Welcome to the FBA - the Fake Basketball Association</h2>

<h4>MVP voting to begin soon</h4>

<div class="container">
    <PlayersList PlayersAll="@SortedPlayerDTOs" />
</div>


@code{

    private List<PlayerDTO> PlayerDTOs;
    private List<PlayerDTO> SortedPlayerDTOs;
    private List<Vote> Votes;

    protected async override Task OnInitializedAsync()
    {

        PlayerDTOs = await playersRepo.GetNbaPlayers();

        Votes = await votesRepo.GetVotes();
        foreach (var vote in Votes)
        {
            var playerForVote = PlayerDTOs.Where(p => p.PlayerId == vote.PlayerId).FirstOrDefault();
            playerForVote.VotesTemp++;
        }

        SortedPlayerDTOs = PlayerDTOs.OrderByDescending(p => p.VotesTemp).ToList();
    }
}
